<div id="paypal-button-container" style="width:250px"></div>
<script src="https://www.paypal.com/sdk/js?client-id={{ clientId }}" data-partner-attribution-id="{{ partnerAttributionId }}"></script>
<script>
    let createPayPalOrderFromPaymentPageUrl = "{{ createPayPalOrderFromPaymentPageUrl }}";
    let completePayPalOrderFromPaymentPageUrl = "{{ completePayPalOrderFromPaymentPageUrl }}";
    let cancelPayPalPaymentUrl = "{{ cancelPayPalPaymentUrl }}";

    paypal.Buttons({
        style: {
            shape: 'pill',
            color: 'gold',
            layout: 'horizontal',
            label: 'paypal',
        },
        locale: '{{ locale }}',
        createOrder: function(data, actions) {
            return fetch(createPayPalOrderFromPaymentPageUrl, {
                method: 'post'
            })
            .then(function(res) {
                if (res.status == 400) {
                    window.location.reload();
                }

                return res.json();
            })
            .then(data => data.order_id);
        },
        onApprove: function(data, actions) {
            return fetch(completePayPalOrderFromPaymentPageUrl, {
                method: 'post'
            }).then(res => res.json()).then(details => window.location.href = details.return_url);
        },
        onCancel: function (data, actions) {
            return fetch(cancelPayPalPaymentUrl, {
                method: 'post',
                headers: { 'content-type': 'application/json' },
                body: JSON.stringify({ payPalOrderId: data.orderID })
            }).then(window.location.reload());
        }
    }).render('#paypal-button-container');
</script>
